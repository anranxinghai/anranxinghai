package com.anranxinghai.musicplayer.http;

import java.io.IOException;
import java.io.UnsupportedEncodingException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.apache.http.HttpEntity;
import org.apache.http.HttpResponse;
import org.apache.http.HttpStatus;
import org.apache.http.NameValuePair;
import org.apache.http.ParseException;
import org.apache.http.client.ClientProtocolException;
import org.apache.http.client.HttpClient;
import org.apache.http.client.entity.UrlEncodedFormEntity;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.impl.client.DefaultHttpClient;
import org.apache.http.message.BasicNameValuePair;
import org.apache.http.util.EntityUtils;


public class RegisterHttp {

	//private String url = "http://10.132.12.114:8080/Server/RegisterServlet";
	private String url = "http://192.168.0.103:8080/Server/RegisterServlet";
	private String result = "请求失败";
	public boolean postSuccess(Map <String,String> params){
		String result = send(url,params);
		result = result.substring(2, result.length());
		byte[] b = result.getBytes();
		for (int i = 0; i < b.length; i++) {
			System.out.println(b[i]);
		}
		if ("registerSuccess".equals(result)) {
			return true;
		} else {
			return false;
		}
	}
	
	public String send(String url, Map <String,String> param){
//		urlString = urlString + "/servlet/SearchDB";
		HttpClient httpClient = new DefaultHttpClient();
		
		HttpResponse httpResponse = null ;
		NameValuePair nameValuePair1  = new BasicNameValuePair("userName",param.get("userName"));
		NameValuePair nameValuePair2  = new BasicNameValuePair("userTel",param.get("userTel"));
		List<NameValuePair> list = new ArrayList<NameValuePair>();
		list.add(nameValuePair1);
		list.add(nameValuePair2);
		HttpEntity httpEntity;
		try {
			httpEntity = new UrlEncodedFormEntity(list);
			HttpPost httpGetRequest = new HttpPost(url);
			httpGetRequest.setEntity(httpEntity);
			
			result = "请求失败";
				try {
					httpResponse = httpClient.execute(httpGetRequest);
				} catch (ClientProtocolException e1) {
					// TODO Auto-generated catch block
					e1.printStackTrace();
				} catch (IOException e1) {
					// TODO Auto-generated catch block
					e1.printStackTrace();
				}
			
			if (httpResponse.getStatusLine().getStatusCode() == HttpStatus.SC_OK) {
				try {
					result  = EntityUtils.toString(httpResponse.getEntity());
				} catch (ParseException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				} catch (IOException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}				
			}else {
				result = "请求失败";
			}
		} catch (UnsupportedEncodingException e1) {
			// TODO Auto-generated catch block
			e1.printStackTrace();
		}
		
		System.out.println(result);
		return result;
	}
	 
}
